<% layout("/layouts/boilerplate") %>



 <div class="row">
  <div class="col-8 offset-2">
<body>
  <h1><%= listing.title %></h1>
  <img src="<%= listing.image.url %>" alt="Book Image" width="300">

  <p> <%= listing.description %></p>
  <p> â‚¹<%= listing.price %></p>

  <ul>
    <li> <%= listing.location %></li>
    <li> <%= listing.country %></li>
  </ul>

  <h3>Seller Info</h3>
  <ul>
    <li><%= listing.seller.name %></li>
    <li> <%= listing.seller.college %></li>
    <li> <%= listing.seller.category %></li>
    <li> <%= listing.seller.contact.phone %></li>
    <li> <%= listing.seller.contact.email %></li>
  </ul>

  <p> <%= listing.dateListed.toDateString() %></p>
  
  


<p><strong>Barter Available</strong>> <%= listing.isBarterAvailable ? "Yes" : "No" %></p>
<br>
<% if (currUser && listing.owner && listing.owner._id.toString() === currUser._id.toString()) { %>
  <div class="d-flex">
    <a href="/listings/<%= listing._id %>/edit" class="btn btn-dark me-4">Edit</a>
    <form action="/listings/<%= listing._id %>?_method=DELETE" method="POST">
      <button type="submit" class="btn btn-dark">Delete</button>
    </form>
  </div>
<% } %>


<% if (currUser && listing.owner && listing.owner._id.toString() === currUser._id.toString()) { %>
  <div>
    <h4>Leave a review</h4>
    <form action="/listings/<%= listing._id %>/reviews" method="POST" class="needs-validation" novalidate>
      <div class="mb-3">
        <label for="comment" class="form-label">Your Comment</label>
        <textarea class="form-control" id="comment" name="comment" rows="3" required></textarea>
        <div class="invalid-feedback">Please enter your comment.</div>
      </div>

      <div class="mb-3">
        <label for="rating" class="form-label">Rating</label>
        <select class="form-select" id="rating" name="rating" required>
          <option value="" disabled selected>Select a rating</option>
          <option value="1">1 - Poor</option>
          <option value="2">2 - Fair</option>
          <option value="3">3 - Good</option>
          <option value="4">4 - Very Good</option>
          <option value="5">5 - Excellent</option>
        </select>
        <div class="invalid-feedback">Please select a rating between 1 and 5.</div>
      </div>

      <button type="submit" class="btn ">Submit Review</button>
    </form>
  </div>
<% } else { %>
  <p class="text-muted">
    Please <a href="/listings/login">login</a> to leave a review.
  </p>
<% } %>

<hr>
<h4>All Reviews</h4>

<% if (listing.reviews.length === 0) { %>
  <p>No reviews yet.</p>
<% } else { %>
  <ul class="list-group mb-4">
    <% listing.reviews.forEach(review => { %>
      <li class="list-group-item">
        <strong>Rating:</strong> <%= review.rating %> <br>
        <strong>Comment:</strong> <%= review.comment %><br>
        <small><%= new Date(review.createdAt).toDateString() %></small><br>
        <small>By: <%= review.author ? review.author.username : "Anonymous" %></small>

        <% if (currUser && review.author && review.author._id.toString() === currUser._id.toString()) { %>
          <form action="/listings/<%= listing._id %>/reviews/<%= review._id %>?_method=DELETE" method="POST" class="mt-2">
            <button class="btn ">Delete</button>
          </form>
        <% } %>
      </li>
    <% }) %>
  </ul>
<% } %>

